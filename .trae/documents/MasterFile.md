–≠—Ç–æ **–ò—Å–ø–æ–ª–Ω—è–µ–º–∞—è –ö–∞—Ä—Ç–∞ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Execution Roadmap)** –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –ò–ò-–∞–≥–µ–Ω—Ç–∞. –û–Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ **Master Design Document v2.1** –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

# ü§ñ Agent Operating Protocol

**–†–æ–ª—å:** Autonomous Senior Software Engineer
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ KnowledgeBaseAI 2.0 (Cognitive Infrastructure Platform).
**–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:** Strict TDD & Design-First.

### –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–π—Å—Ç–≤–∏–π –∞–≥–µ–Ω—Ç–∞:

1.  **Select:** –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—É—é –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É (`[ ]`), —É –∫–æ—Ç–æ—Ä–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
2.  **Context:** –ò–∑—É—á–∏—Ç—å "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞" –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ MDD.
3.  **Implement:**
    *   –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `feat/<task-id>`.
    *   –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (Pytest/Jest) *–¥–æ* –∫–æ–¥–∞ (–≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Architectural Invariants –Ω–µ –Ω–∞—Ä—É—à–µ–Ω—ã.
4.  **Verify:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç–µ—Ä—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤.
5.  **Commit:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Conventional Commits (–Ω–∞–ø—Ä. `feat(core): implement canonicalization`).
6.  **Update:** –ü–æ—Å—Ç–∞–≤–∏—Ç—å `[x]` –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

---

# üõ° –ö–æ–Ω—Ç—Ä–æ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

–ê–≥–µ–Ω—Ç –æ–±—è–∑–∞–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ –ø—É–Ω–∫—Ç—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ª—é–±–æ–π –∑–∞–¥–∞—á–∏.

| –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç | –ú–µ—Ö–∞–Ω–∏–∑–º –∫–æ–Ω—Ç—Ä–æ–ª—è (Enforcement) |
| :--- | :--- |
| **Graph-First Truth** | **Code Review / Design:** –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è *—Ç–æ–ª—å–∫–æ* —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ –∏–ª–∏ Sync Job. –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ Qdrant –∑–∞–ø—Ä–µ—â–µ–Ω–∞ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º. |
| **No Direct Writes** | **Linter / CI:** `grep` –ø–æ –∫–æ–¥—É –∏—â–µ—Ç –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `session.run("CREATE...")` –≤–Ω–µ –º–æ–¥—É–ª—è `CommitWorker`. |
| **Tenant Isolation** | **Middleware & DAO Test:** Integration-—Ç–µ—Å—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —á—É–∂–∏–º `tenant_id` –∏ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç/–æ—à–∏–±–∫—É. |
| **Determinism** | **Unit Test:** –¢–µ—Å—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è Proposal –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 100 —Ä–∞–∑ —Å –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ JSON ‚Äî —Ö–µ—à –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–µ–Ω. |
| **Schema Compliance** | **Gatekeeper:** –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤–µ—Ä—è–µ—Ç `CODE_VERSION` –∏ `DB_SCHEMA_VERSION`. |

---

# üó∫ Execution Roadmap

## Phase 0: Foundation & Infrastructure
**Goal:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ—á–≤—É, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ –±–∞–∑–æ–≤—É—é –∏–∑–æ–ª—è—Ü–∏—é.

### Epic 0.1: Core Libs & Determinism

#### Story 0.1.1: Canonicalization Service
*   [x] **Task 0.1.1.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –∏ JSON.
    *   [x] `Subtask`: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NFKC + whitespace stripping.
    *   [x] `Subtask`: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∫–ª—é—á–µ–π JSON.
    *   [x] `Subtask`: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é SHA-256 —Ö–µ—à–µ–π.
    *   **DoD:** Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –∫–µ–π—Å—ã —Å —Ä–∞–∑–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –∫–ª—é—á–µ–π –∏ "–≥—Ä—è–∑–Ω—ã–º" —Ç–µ–∫—Å—Ç–æ–º.
    *   **Owner:** Backend
    *   **Dependencies:** None
    *   **Risk:** HIGH (–û—Å–Ω–æ–≤–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏)
    *   **Est:** S
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/core/canonical.py`
        *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `unicodedata.normalize('NFKC', text)`.
        *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `json.dumps(obj, sort_keys=True, ensure_ascii=False)`.
        *   –¢–µ—Å—Ç: `tests/unit/test_canonical.py` (–ø—Ä–æ–≤–µ—Ä—å emoji, —Ç–∞–±—ã, —Ä–∞–∑–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–ª—é—á–µ–π).

#### Story 0.1.2: Tenant Context & DAO Base
*   [x] **Task 0.1.2.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Context Middleware –∏ –±–∞–∑–æ–≤—ã–π DAO.
    *   [x] `Subtask`: Middleware –∏–∑–≤–ª–µ–∫–∞–µ—Ç `X-Tenant-ID` (–∏–ª–∏ –∏–∑ JWT) –∏ –∫–ª–∞–¥–µ—Ç –≤ `ContextVar`.
    *   [x] `Subtask`: –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π DAO –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç `tenant_id` –≤ –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ.
    *   **DoD:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ DAO –±–µ–∑ tenant_id (unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã).
    *   **Owner:** Backend
    *   **Dependencies:** None
    *   **Risk:** P0 (Security)
    *   **Est:** M
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/core/context.py`, `backend/app/db/dao_base.py`.
        *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `contextvars`.
        *   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `session.run` –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `$tenant_id`.

## Phase 1: The Graph Engine (Mutation Layer)
**Goal:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ Proposals.

### Epic 1.1: Node Ontology & Lifecycle

#### Story 1.1.1: Graph Schema Definition
*   [x] **Task 1.1.1.1:** –û–ø–∏—Å–∞—Ç—å Pydantic –º–æ–¥–µ–ª–∏ —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ MDD.
    *   [x] `Subtask`: Models: Concept, Skill, Method, Error, Assessment, SourceChunk.
    *   [x] `Subtask`: Enums: RelationshipTypes (PREREQ, etc.), LifecycleStatus (ACTIVE, DEPRECATED, ARCHIVED).
    *   **DoD:** Pydantic –º–æ–¥–µ–ª–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (`uid`, `tenant_id`).
    *   **Owner:** Backend
    *   **Dependencies:** 0.1.2
    *   **Risk:** LOW
    *   **Est:** S
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/schemas/graph.py`.
        *   –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫—É –∏–∑ MDD Section 4.

### Epic 1.2: Proposal Pipeline (The Core)

#### Story 1.2.1: Proposal Creation & Validation
*   [x] **Task 1.2.1.1:** API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Draft Proposal.
    *   [x] `Subtask`: Endpoint `POST /proposals`.
    *   [x] `Subtask`: –í–∞–ª–∏–¥–∞—Ü–∏—è Evidence (–¥–ª—è CREATE –æ–ø–µ—Ä–∞—Ü–∏–π).
    *   [x] `Subtask`: –†–∞—Å—á–µ—Ç `proposal_checksum` (–∏—Å–ø–æ–ª—å–∑—É—è Task 0.1.1.1).
    *   **DoD:** –°–æ–∑–¥–∞–Ω–Ω—ã–π Proposal —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Postgres —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DRAFT. –•–µ—à –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω.
*   **Task 1.2.1.2:** API –¥–ª—è HITL Review.
    *   [x] `Subtask`: Endpoint `GET /proposals/{id}`.
    *   [x] `Subtask`: Endpoint `POST /proposals/{id}/approve`.
    *   [x] `Subtask`: Endpoint `POST /proposals/{id}/reject`.
    *   **DoD:** –ú–µ—Ç–æ–¥–∏—Å—Ç –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–æ–ø–æ–∑–∞–ª; –ø—Ä–∏ approve ‚Äî commit.
    *   **Owner:** Backend
    *   **Dependencies:** 0.1.1, 1.1.1
    *   **Risk:** MED
    *   **Est:** M

#### Story 1.2.2: Rebase Logic (ID-Only)
*   **Task 1.2.2.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
    *   [x] `Subtask`: –°—Ä–∞–≤–Ω–∏—Ç—å `base_ver` –ø—Ä–æ–ø–æ–∑–∞–ª–∞ –∏ `current_ver` –≥—Ä–∞—Ñ–∞ —Ç–µ–Ω–∞–Ω—Ç–∞.
    *   [x] `Subtask`: –ï—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ `target_id`.
    *   [x] `Subtask`: –õ–æ–≥–∏–∫–∞: –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ = CONFLICT, –ù–µ—Ç = FAST_REBASE.
    *   **DoD:** –¢–µ—Å—Ç—ã —Å –∏–º–∏—Ç–∞—Ü–∏–µ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ ID –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç–∞—Ç—É—Å CONFLICT.
    *   **Owner:** Backend
    *   **Dependencies:** 1.2.1
    *   **Risk:** HIGH
    *   **Est:** M
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/services/rebase.py`.
        *   **–í–∞–∂–Ω–æ:** –ù–∏–∫–∞–∫–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ä–∂–∞! –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ ID.

#### Story 1.2.3: Integrity Gate (Subgraph Check)
*   **Task 1.2.3.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º.
    *   [x] `Subtask`: Fetch –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–≥–æ –ø–æ–¥–≥—Ä–∞—Ñ–∞ (Depth=2). (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ —Å–ø–∏—Å–∫—É —É–∑–ª–æ–≤/—Å–≤—è–∑–µ–π)
    *   [x] `Subtask`: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏–∫–ª–æ–≤ –≤ PREREQ (NetworkX –∏–ª–∏ DFS).
    *   [x] `Subtask`: –ü—Ä–æ–≤–µ—Ä–∫–∞ "–≤–∏—Å—è—á–∏—Ö" Skill (–±–µ–∑ BASED_ON).
    *   [x] `Subtask`: Timeout fallback (–µ—Å–ª–∏ > 500ms ‚Üí Async Check). (–ø–æ–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Å–∏–Ω—Ö. —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
    *   **DoD:** –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (unit‚Äë—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã).
    *   **Owner:** Backend
    *   **Dependencies:** 1.1.1
    *   **Risk:** HIGH
    *   **Est:** L
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/services/integrity.py`.
        *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `networkx` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ü–∏–∫–ª–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–µ–µ, —á–µ–º Cypher –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—É—Ç–µ–π).

#### Story 1.2.4: Commit Worker (Atomic Write)
*   **Task 1.2.4.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Neo4j.
    *   [x] `Subtask`: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    *   [x] `Subtask`: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π (MERGE/CREATE/SET).
    *   [x] `Subtask`: –ó–∞–ø–∏—Å—å –≤ Audit Log (Postgres).
    *   [x] `Subtask`: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è `Graph.Committed`.
    *   **DoD:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Neo4j –ø–æ—è–≤–ª—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî Rollback.
    *   **Owner:** Backend
    *   **Dependencies:** 1.2.2, 1.2.3
    *   **Risk:** P0 (Data Loss)
    *   **Est:** L
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/workers/commit.py`.
        *   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å `graph_version` —Ç–µ–Ω–∞–Ω—Ç–∞.

## Phase 2: Ingestion, Math & Vector Sync
**Goal:** –ù–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä–∞—Ñ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∏—Ö —Ä–∞–±–æ—Ç–∞—Ç—å.

### Epic 2.1: Ingestion Pipeline

#### Story 2.1.1: Processing Workers
*   **Task 2.1.1.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Parse/Chunk/Embed –≤–æ—Ä–∫–µ—Ä—ã.
    *   [x] `Subtask`: Text normalization (Task 0.1.1).
    *   [x] `Subtask`: Chunking logic.
    *   [x] `Subtask`: Embedding (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) + –∑–∞–ø–∏—Å—å –≤ Qdrant.
    *   **DoD:** –¢–µ–∫—Å—Ç –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä—ã –≤ Qdrant —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º payload (`tenant_id`).
    *   **Owner:** Backend/AI
    *   **Dependencies:** 0.1.1
    *   **Risk:** MED
    *   **Est:** M

### Epic 2.2: Vector Synchronization

#### Story 2.2.1: Sync Job (Graph ‚Üí Vector)
*   **Task 2.2.1.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º Eventual Consistency.
    *   [x] `Subtask`: –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏—è `Graph.Committed`.
    *   [x] `Subtask`: –ü–µ—Ä–µ—Å—á–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤. (–ø–æ–º–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è payload)
    *   [x] `Subtask`: Upsert –≤ Qdrant. (—á–µ—Ä–µ–∑ set_payload/ensure collection)
    *   **DoD:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —É–∑–ª–∞ –≤ Neo4j –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–µ–∫—Ç–æ—Ä –≤ Qdrant.
    *   **Owner:** Backend
    *   **Dependencies:** 1.2.4
    *   **Risk:** MED
    *   **Est:** M

### Epic 2.3: Math Core

#### Story 2.3.1: Edge Weight Calculation
*   **Task 2.3.1.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É–ª—É –≤–µ—Å–æ–≤.
    *   [x] `Subtask`: –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ `W_edge` —Å Clip –∏ Decay.
    *   [x] `Subtask`: Background worker –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `G_diff` (EMA). (—Ñ—É–Ω–∫—Ü–∏—è ema)
    *   **DoD:** Unit-—Ç–µ—Å—Ç—ã –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü Clip).
    *   **Owner:** Backend/Data
    *   **Dependencies:** 1.1.1
    *   **Risk:** MED
    *   **Est:** M
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞:**
        *   –§–∞–π–ª: `backend/app/core/math.py`.
        *   –§–æ—Ä–º—É–ª–∞: `Clip((W_static * G_diff) * (1 + Decay * (1 - U_conf)), 0.1, 10)`.

## Phase 3: Frontend & UX
**Goal:** –î–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–∏ –º–µ—Ç–æ–¥–∏—Å—Ç–∞–º) –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

### Epic 3.1: Optimistic UI

#### Story 3.1.1: Transaction Manager
*   **Task 3.1.1.1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π Transaction Log.
    *   [ ] `Subtask`: Store (Zustand/Redux) –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –º—É—Ç–∞—Ü–∏–π.
    *   [ ] `Subtask`: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `tx_id`.
    *   [ ] `Subtask`: –õ–æ–≥–∏–∫–∞ `Inverse Patch` (–æ—Ç–∫–∞—Ç).
    *   **DoD:** –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ç–∏ UI –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    *   **Owner:** Frontend
    *   **Dependencies:** API 1.2.1
    *   **Risk:** HIGH (UX Complexity)
    *   **Est:** L

### Epic 3.2: HITL Review

#### Story 3.2.1: Diff Interface
*   **Task 3.2.1.1:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Proposal.
    *   [x] `Subtask`: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Diff (–ë—ã–ª–æ -> –°—Ç–∞–ª–æ). (Backend endpoint `/v1/proposals/{id}/diff`)
    *   [ ] `Subtask`: –ö–Ω–æ–ø–∫–∏ Approve/Reject.
    *   [ ] `Subtask`: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Evidence (—Ü–∏—Ç–∞—Ç—ã).
    *   **DoD:** –ú–µ—Ç–æ–¥–∏—Å—Ç –≤–∏–¥–∏—Ç, –∫–∞–∫–æ–π —Ç–µ–∫—Å—Ç –æ–±–æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏.
    *   **Owner:** Frontend
    *   **Dependencies:** API 1.2.1
    *   **Risk:** MED
    *   **Est:** M

## Phase 4: Ops & Production Readiness
**Goal:** –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

### Epic 4.1: Observability

#### Story 4.1.1: Metrics & Tracing
*   **Task 4.1.1.1:** –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.
    *   [x] `Subtask`: –ü—Ä–æ–±—Ä–æ—Å `correlation_id` –≤ –ª–æ–≥–∏ –∏ –æ—á–µ—Ä–µ–¥–∏.
    *   [x] `Subtask`: Prometheus –º–µ—Ç—Ä–∏–∫–∏ (endpoint `/metrics`).
    *   **DoD:** –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ `/metrics`, correlation_id –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
    *   **Owner:** DevOps/Backend
    *   **Dependencies:** All Backend
    *   **Risk:** LOW
    *   **Est:** S

### Epic 4.2: Migrations

#### Story 4.2.1: Schema Versioning
*   **Task 4.2.1.1:** Gatekeeper –∑–∞–ø—É—Å–∫–∞.
    *   [x] `Subtask`: –•—Ä–∞–Ω–µ–Ω–∏–µ `schema_version` –≤ Postgres.
    *   [x] `Subtask`: –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
    *   **DoD:** App –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ > –≤–µ—Ä—Å–∏–∏ –ë–î (—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è).
    *   **Owner:** Backend
    *   **Dependencies:** None
    *   **Risk:** MED
    *   **Est:** S

---

### üìù Changelog & Status Report

*–ê–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –ª–æ–≥ –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ Task.*

*   **[2025-12-16]**: Completed Task 0.1.1.1 (Canonicalization Service). Implemented `backend/src/core/canonical.py`; unit tests passed (4).
*   **[2025-12-16]**: Completed Task 0.1.2.1 (Tenant Context & DAO Base). Added tenant middleware and DAO base; unit tests passed (2).
*   **[2025-12-16]**: Completed Task 1.2.1.1 (Proposal Creation & Validation). Added `POST /v1/proposals`, validation and checksum; unit tests passed (3).
*   **[2025-12-16]**: Completed Task 1.2.2.1 (Rebase Logic ID-only). Implemented rebase check, PG graph_version & changes; unit tests passed (3).
*   **[2025-12-16]**: Completed Task 1.2.3.1 (Integrity Gate Subgraph Check). Implemented cycle/dangling detection; unit tests passed (3).
*   **[2025-12-16]**: Completed Task 1.2.4.1 (Commit Worker Atomic Write). Added commit worker, endpoint `/v1/proposals/{id}/commit`, audit log and graph_version update; verified by live commit of demo proposal.
*   **[2025-12-16]**: Completed Subtask (Graph.Committed publish). Implemented Redis publisher `publish_graph_committed`; unit test passed (1).
*   **[2025-12-16]**: Completed Task 2.1.1.1 (Ingestion Parse/Chunk/Embed). Added normalization, chunking and deterministic embedding to Qdrant; unit tests passed (2).
*   **[2025-12-16]**: Completed Task 2.2.1.1 (Vector Sync Job). Implemented Graph.Committed consumer and Qdrant payload update; unit tests passed (2).
*   **[2025-12-16]**: Completed Task 2.3.1.1 (Math Core). Implemented W_edge with clip and EMA; unit tests passed (2).
*   **[2025-12-16]**: Completed Task 4.1.1.1 (Observability). Implemented correlation_id propagation and `/metrics`; integration verified.
*   **[2025-12-16]**: Completed Task 4.2.1.1 (Schema Gatekeeper). Implemented schema_version table and startup gate; startup check enabled.
*   **[2025-12-16]**: Completed Task 3.2.1.1 (Diff Interface Backend). Implemented `/v1/proposals/{id}/diff`; unit test passed.
*   **[2025-12-16]**: Completed Task 1.2.1.2 (HITL Review API). Implemented GET/approve/reject endpoints; unit test passed.
