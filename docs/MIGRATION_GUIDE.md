# Гайд миграции данных к канону

Этот документ описывает безопасную конвертацию существующего графа к канонической спецификации и ввод `tenant_id`.

## Подготовка
- Убедитесь, что есть бэкап Neo4j.
- Настройте переменные окружения `NEO4J_URI`, `NEO4J_USER`, `NEO4J_PASSWORD`.

## Запуск миграции

```bash
python backend/scripts/migrate_graph_to_canon.py
```

Скрипт выполняет:
- Удаление узлов `User` и связей `COMPLETED`/`EVIDENCED_BY`.
- Замены запрещённых отношений на канонические (`HAS_SECTION` → `CONTAINS`, `REQUIRES_SKILL` → `USES_SKILL`, и т.д.).
- Введение `tenant_id` для всех узлов, где он отсутствует (`default`).
- Обеспечение иерархии `Section` → `Subsection` → `Topic`.
- Удаление осиротевших узлов.

## После миграции
- Перезапустите сервисы.
- Проверьте API `/v1/graph/viewport` и `/v1/graph/roadmap` для предметов.
- Убедитесь, что фронтенд не вызывает устаревшие связи (`HAS_*`).

## Ограничения
- Запускайте скрипт только в maintenance‑окне.
- Все будущие изменения только через Proposal Pipeline.

