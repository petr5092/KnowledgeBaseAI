# Отчет по анализу проблемы "Пустой ответ /v1/knowledge/topics/available"

## 1. Симптомы
При запросе к API `POST /v1/knowledge/topics/available` с телом:
```json
{
  "subject_uid": "SUB-MATHEMATICS-e1f035",
  "user_context": { "user_class": 0 }
}
```
Возвращается пустой список `items: []`.

## 2. Диагностика данных (Neo4j)
Была проведена серия прямых проверок базы данных через Docker-контейнер.

### Статистика графа
В базе присутствуют данные:
*   **Subjects:** 2
*   **Sections:** 6
*   **Topics:** 72
*   **Связи CONTAINS:** 96

### Проверка конкретных Subject UID
1.  **`SUB-MATHEMATICS-e1f035`** (из запроса пользователя):
    *   Статус: **Существует**.
    *   Связи: Имеет 3 секции.
    *   Темы: **0 связанных тем** (через цепочку `Subject -> Section -> Topic`).
2.  **`SUB-MATHEMATICS-5902da`** (найден в базе):
    *   Статус: **Существует**.
    *   Темы: **0 связанных тем**.
3.  **`SUB-MATH`** (предполагаемый ID):
    *   Статус: **Не найден**.

## 3. Причина проблемы
В графе нарушена целостность цепочки иерархии для существующих предметов.
Хотя в базе есть 72 топика и 6 секций, они **не связаны** корректным образом с предметом `SUB-MATHEMATICS-e1f035` в полную структуру `Subject -> CONTAINS -> Section -> CONTAINS -> Topic`.

Вероятнее всего, топики "висят" отдельно или привязаны к Секциям, которые не привязаны к этим Предметам.

## 4. Рекомендации по исправлению

### Вариант А: Перезаливка данных (Рекомендуемый)
Использовать штатный механизм генерации предмета, который гарантирует создание правильных связей.
1.  Очистить базу (опционально).
2.  Выполнить POST запрос на генерацию:
    ```bash
    curl -X POST "http://localhost:8000/v1/admin/generate_subject" \
         -H "Content-Type: application/json" \
         -d '{"title": "Mathematics", "uid": "SUB-MATH"}'
    ```

### Вариант Б: Ручное исправление связей (Cypher)
Если данные ценны, можно попытаться восстановить связи вручную:
```cypher
MATCH (s:Subject {uid: "SUB-MATHEMATICS-e1f035"}), (sec:Section)
MERGE (s)-[:CONTAINS]->(sec)
```
*(Однако это опасно без понимания, какие именно секции к какому предмету должны относиться)*.

## 5. Вывод
API работает корректно (код логичный), проблема исключительно в **качестве данных** в Neo4j. Необходимо перезаполнить граф корректной иерархией.
