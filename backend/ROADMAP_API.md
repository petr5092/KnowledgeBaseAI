# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –î–æ—Ä–æ–∂–Ω–æ–π –ö–∞—Ä—Ç—ã (Roadmap)

## –û–±–∑–æ—Ä
–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞. –û–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã —Å –ø–æ–º–æ—â—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ LLM, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –Ω–∞ –º–∏–∫—Ä–æ-—É—Ä–æ–∫–∏ (I Do / We Do / You Do).

- **URL**: `/v1/engine/roadmap` (–ø—É—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ä–æ—É—Ç–µ—Ä–∞, –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –≤ `engine.py`)
- **–ú–µ—Ç–æ–¥**: `POST`
- **Summary**: Build adaptive roadmap
- **Implementation**: [engine.py:L148](file:///root/KnowledgeBaseAI/backend/app/api/engine.py#L148)

---

## 1. –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (Request Body)

–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ö–µ–º–µ `RoadmapRequest`.

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| `subject_uid` | `string` | –ù–µ—Ç | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ (Subject UID), –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç—Å—è –∫–∞—Ä—Ç–∞. |
| `limit` | `integer` | –ù–µ—Ç | –õ–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö —Ç–µ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30, –Ω–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ —Å–µ–π—á–∞—Å –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ 5 –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏). |
| `current_progress` | `object` | –ù–µ—Ç | –°–ª–æ–≤–∞—Ä—å —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≥–¥–µ –∫–ª—é—á ‚Äî `topic_uid`, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –æ—Ü–µ–Ω–∫–∞ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ (`float` –æ—Ç 0.0 –¥–æ 1.0). |
| `user_context` | `object` | **–î–∞** | –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–º. —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∏–∂–µ). |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `user_context`
| –ü–æ–ª–µ | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| `language` | `string` | `"ru"` | –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| `attributes` | `object` | `{}` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã (–∫–ª–∞—Å—Å, –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ —Ç.–¥.). |
| `user_class` | `integer` | `null` | –ö–ª–∞—Å—Å –æ–±—É—á–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å). |
| `age` | `integer` | `null` | –í–æ–∑—Ä–∞—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å). |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "subject_uid": "SUBJ-MATH-001",
  "limit": 5,
  "current_progress": {
    "TOPIC-ALG-001": 0.9,
    "TOPIC-ALG-002": 0.4
  },
  "user_context": {
    "language": "ru",
    "user_class": 9
  }
}
```

---

## 2. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ (Response Body)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç —Å—Ö–µ–º—ã `RoadmapResponse`.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `max_score` | `integer` | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –≤ —ç—Ç–æ–π –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç–µ. |
| `nodes` | `array` | –°–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤ (—Ç–µ–º) –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã. |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `RoadmapNode` (—ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ `nodes`)
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `topic_uid` | `string` | UID —Ç–µ–º—ã. |
| `title` | `string` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã. |
| `description` | `string` | –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è LLM, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ). |
| `status` | `string` | –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞: `locked` (–∑–∞–∫—Ä—ã—Ç–æ), `available` (–¥–æ—Å—Ç—É–ø–Ω–æ), `completed` (–ø—Ä–æ–π–¥–µ–Ω–æ). |
| `max_score` | `integer` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –∑–∞ —ç—Ç—É —Ç–µ–º—É. |
| `current_score` | `float` | –¢–µ–∫—É—â–∏–π –±–∞–ª–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞). |
| `progress_percentage` | `float` | –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ–º—ã. |
| `units` | `array` | –°–ø–∏—Å–æ–∫ –º–∏–∫—Ä–æ-—É—Ä–æ–∫–æ–≤ (MicroLesson), —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É. |
| `final_test` | `object` | –û–±—ä–µ–∫—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (LessonUnit), –º–æ–∂–µ—Ç –±—ã—Ç—å null. |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `MicroLesson` (—ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ `units`)
–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ-—É—Ä–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—É—é —É—á–µ–±–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É, —Å–æ—Å—Ç–æ—è—â—É—é –∏–∑ —Ç—Ä–µ—Ö —Ñ–∞–∑.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `order` | `integer` | –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–º—ã. |
| `title` | `string` | –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç–µ–º—É"). |
| `i_do` | `object` | –§–∞–∑–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è (LessonUnit), –º–æ–∂–µ—Ç –±—ã—Ç—å null. |
| `we_do` | `object` | –§–∞–∑–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ (LessonUnit), –º–æ–∂–µ—Ç –±—ã—Ç—å null. |
| `you_do` | `object` | –§–∞–∑–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã (LessonUnit), –º–æ–∂–µ—Ç –±—ã—Ç—å null. |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `LessonUnit` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `i_do`, `we_do`, `you_do`, `final_test`)
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `uid` | `string` | UID –µ–¥–∏–Ω–∏—Ü—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞. |
| `type` | `string` | –¢–∏–ø: `lesson_i_do`, `lesson_we_do`, `lesson_you_do`, `lesson_test`. |
| `title` | `string` | –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–∑—É—á–µ–Ω–∏–µ (I Do)"). |
| `payload` | `object` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ (—Ç–µ–∫—Å—Ç, –º–µ–¥–∏–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã). |

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "max_score": 15,
  "nodes": [
    {
      "topic_uid": "TOPIC-ALG-002",
      "title": "–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
      "status": "available",
      "max_score": 6,
      "current_score": 0.0,
      "progress_percentage": 0.0,
      "units": [
        {
          "order": 1,
          "title": "–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç",
          "i_do": {
            "uid": "UNIT-001",
            "type": "lesson_i_do",
            "title": "–ò–∑—É—á–µ–Ω–∏–µ (I Do)",
            "payload": { "content": "..." }
          },
          "we_do": {
             "uid": "UNIT-002",
             "type": "lesson_we_do",
             "title": "–ü—Ä–∞–∫—Ç–∏–∫–∞ (We Do)",
             "payload": { "content": "..." }
          },
          "you_do": {
             "uid": "UNIT-003",
             "type": "lesson_you_do",
             "title": "–ó–∞–¥–∞–Ω–∏–µ (You Do)",
             "payload": { "content": "..." }
          }
        }
      ],
      "final_test": {
        "uid": "UNIT-TEST-01",
        "type": "lesson_test",
        "title": "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç",
        "payload": { "questions_count": 5 }
      }
    }
  ]
}
```

---

## 3. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (–ê–ª–≥–æ—Ä–∏—Ç–º)

–ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4-—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤.

### –≠—Ç–∞–ø 1: –í—ã–±–æ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (Candidate Selection)
–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≥—Ä–∞—Ñ–æ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Neo4j, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –≤—Å–µ —Ç–µ–º—ã, –≤—Ö–æ–¥—è—â–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç (`subject_uid`).
*   **–ó–∞–ø—Ä–æ—Å**: –ò—â–µ—Ç —Å–≤—è–∑–∏ `Subject -> Section -> Topic` (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã).
*   **–õ–∏–º–∏—Ç**: –ò–∑ –±–∞–∑—ã –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è **20 —Ç–µ–º** (–∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤). –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –¥–∞—Ç—å AI –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –≤—ã–±–æ—Ä, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç.
*   **–î–∞–Ω–Ω—ã–µ**: –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫, —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —É—á–µ–±–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã (`ContentUnit`).

### –≠—Ç–∞–ø 2: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (AI Filtering & Content Generation)
–°–ø–∏—Å–æ–∫ –∏–∑ 20 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ —Å–ª–æ–≤–∞—Ä—å —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ (`current_progress`) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ LLM (GPT-4o-mini) —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º.

**–ó–∞–¥–∞—á–∏ AI:**
1.  **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤**: –ù–∞–π—Ç–∏ —Ç–µ–º—ã, –≥–¥–µ –æ—Ü–µ–Ω–∫–∞ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –Ω–∏–∑–∫–∞—è (< 0.6). –û–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
2.  **–í—ã–±–æ—Ä –Ω–æ–≤—ã—Ö —Ç–µ–º**: –ï—Å–ª–∏ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–µ—Ç, –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ –ª–æ–≥–∏–∫–µ —Ç–µ–º—ã (–æ—Ü–µ–Ω–∫–∞ 0.0).
3.  **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –í—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ **5 –ª—É—á—à–∏—Ö —Ç–µ–º** –¥–ª—è —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è.
4.  **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: –ï—Å–ª–∏ —É —Ç–µ–º—ã –≤ –±–∞–∑–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ, AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

### –≠—Ç–∞–ø 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (Status Logic)
–î–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 5 –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–º –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
*   üü¢ **completed** (–ü—Ä–æ–π–¥–µ–Ω–æ): –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ (`current_score`) ‚â• 0.8 (80%).
*   üü° **available** (–î–æ—Å—Ç—É–ø–Ω–æ):
    *   –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ > 0 (—Ç–µ–º–∞ –Ω–∞—á–∞—Ç–∞).
    *   –ò–õ–ò –µ—Å–ª–∏ —ç—Ç–æ **–ø–µ—Ä–≤–∞—è** —Ç–µ–º–∞ –≤ —Å–ø–∏—Å–∫–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ 0). –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —É —É—á–µ–Ω–∏–∫–∞ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å.
*   üî¥ **locked** (–ó–∞–∫—Ä—ã—Ç–æ): –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã, –¥–æ –∫–æ—Ç–æ—Ä—ã—Ö –æ—á–µ—Ä–µ–¥—å –µ—â–µ –Ω–µ –¥–æ—à–ª–∞.

### –≠—Ç–∞–ø 4: –°–±–æ—Ä–∫–∞ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–∫–æ–≤ (Lesson Assembly)
–í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è "—Å—ã—Ä—ã–µ" –µ–¥–∏–Ω–∏—Ü—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`ContentUnit`), –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏.

1.  **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –û—Ç–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —é–Ω–∏—Ç—ã —Ç–∏–ø–æ–≤ `lesson_i_do`, `lesson_we_do`, `lesson_you_do` –∏ `lesson_test`.
2.  **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ `order`**:
    *   –Æ–Ω–∏—Ç—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –ø–æ–ª—é `payload.order` (–ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞).
    *   –í—Å–µ —é–Ω–∏—Ç—ã —Å `order: 1` —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –æ–¥–∏–Ω `MicroLesson`.
    *   –í–Ω—É—Ç—Ä–∏ –º–∏–∫—Ä–æ-—É—Ä–æ–∫–∞ –æ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä–æ–ª—è–º: `i_do` (—Ç–µ–æ—Ä–∏—è), `we_do` (–ø—Ä–∞–∫—Ç–∏–∫–∞), `you_do` (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ).
3.  **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç**: –Æ–Ω–∏—Ç —Å —Ç–∏–ø–æ–º `lesson_test` –≤—ã–Ω–æ—Å–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `final_test` (–æ–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–º—É).
4.  **–†–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤**:
    *   +1 –±–∞–ª–ª –∑–∞ –∫–∞–∂–¥—É—é –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–∑—ã –≤ —É—Ä–æ–∫–µ (–º–∞–∫—Å. 3 –±–∞–ª–ª–∞ –∑–∞ —É—Ä–æ–∫).
    *   +3 –±–∞–ª–ª–∞ –∑–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç.
    *   –°—É–º–º–∞ –±–∞–ª–ª–æ–≤ –≤—Å–µ—Ö —Ç–µ–º —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `max_score` –≤—Å–µ–π –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã.

---

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Assessment)

–•–æ—Ç—è –ª–æ–≥–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —ç—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**:

1.  **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data Flow)**:
    *   –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ (`/v1/assessment/next`) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª (mastery score).
    *   –ö–ª–∏–µ–Ω—Ç (Frontend) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —ç—Ç–æ—Ç –±–∞–ª–ª –ª–æ–∫–∞–ª—å–Ω–æ.
    *   –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã (`/v1/engine/roadmap`), –∫–ª–∏–µ–Ω—Ç **—è–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç** —ç—Ç–æ—Ç –±–∞–ª–ª –≤ –ø–æ–ª–µ `current_progress`.
    *   –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ–º (score > 0.7) –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤.

2.  **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä—è–º–æ–π —Å–≤—è–∑–∏ –ë–î**:
    *   –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤ –≥—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π Neo4j –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞.
    *   –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î, –ø–æ–ª–∞–≥–∞—è—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ `current_progress`.

3.  **–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è**:
    *   –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–≤—è–∑–∏ `(:User)-[:MASTERS]->(:Topic)` –≤ Neo4j –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –∫–ª–∏–µ–Ω—Ç–∞.
