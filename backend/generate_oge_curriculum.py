import asyncio
import sys
import os

# Ensure we can import app
sys.path.append(os.getcwd())

from app.services.curriculum.builder import generate_curriculum_llm

fipi_oge_2026 = """
СТРУКТУРА ОГЭ 2026 (МАТЕМАТИКА) - 25 ЗАДАНИЙ:

Часть 1 (С кратким ответом):
Задания 1-5: Практико-ориентированные задачи (общий сюжет: План участка, Шины, Листы бумаги, Печи, Тарифы, План квартиры, Земледелие).
6. Числа и вычисления (Дроби, степени, порядок действий).
7. Числовая прямая (Сравнение чисел, координатная прямая).
8. Алгебраические выражения (Преобразование выражений, степени, корни).
9. Уравнения (Линейные, квадратные, полные/неполные).
10. Теория вероятностей (Классическая вероятность).
11. Графики функций (Соотнесение графиков и формул: прямая, парабола, гипербола).
12. Расчеты по формулам (Подстановка значений в физические/математические формулы).
13. Неравенства и системы неравенств (Линейные, квадратные).
14. Арифметическая и геометрическая прогрессии (Задачи с практическим содержанием).
15. Геометрия: Треугольники (Углы, биссектрисы, медианы).
16. Геометрия: Окружность (Хорды, касательные, вписанные углы).
17. Геометрия: Четырехугольники (Площади, периметры, свойства).
18. Геометрия на клетчатой бумаге (Площади фигур, тангенс угла).
19. Анализ геометрических высказываний (Верно/неверно).

Часть 2 (С развернутым ответом):
20. Алгебраическое выражение, уравнение или неравенство (Сложное, системы, метод замены).
21. Текстовая задача (Движение по воде/суше, совместная работа, смеси/сплавы).
22. Функции и их графики (Построение кусочной функции, задача с параметром).
23. Геометрическая задача на вычисление (Требует обоснования).
24. Геометрическая задача на доказательство.
25. Сложная геометрическая задача (Высокий уровень сложности).
"""

async def main():
    task = {
        "goal": f"Подготовка к ОГЭ по математике 2026. Учесть все 25 заданий.\n{fipi_oge_2026}",
        "audience": "Ученики 9 класса",
        "subject_uids": ["MATH-FULL-V1"],
        "language": "ru"
    }

    print("Starting OGE curriculum generation...")
    print(f"\nGenerating for goal: {task['goal'].splitlines()[0]}...")
    
    res = await generate_curriculum_llm(
        goal=task["goal"],
        audience=task["audience"],
        subject_uids=task["subject_uids"],
        language=task["language"]
    )
    
    if res.get("ok"):
        print(f"SUCCESS: Created curriculum {res.get('code')} - {res.get('title')}")
        print(f"Items count: {res.get('items_count')}")
    else:
        print(f"FAILED: {res.get('error')}")

if __name__ == "__main__":
    asyncio.run(main())
